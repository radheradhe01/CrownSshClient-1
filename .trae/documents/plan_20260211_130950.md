# Troubleshooting and Fixing Login Issues

The application uses Google OAuth 2.0 for authentication. Based on the project structure and configuration, the "Having issues in login" report likely stems from environment mismatch or OAuth configuration issues.

## 1. Environment and OAuth Verification
- **Mismatch Check**: The `.env` file currently points to `localhost`. If the user is accessing `https://sshclient.crownitsolution.com` (as seen in the screenshot), the OAuth callback will fail because Google will redirect to `localhost` or the domain mismatch will trigger a security error.
- **Callback URL**: Verify that the Google Cloud Console has both `http://localhost:7002/api/auth/google/callback` and `https://sshclient.crownitsolution.com/api/auth/google/callback` as authorized redirect URIs.

## 2. Technical Implementation Plan

### Phase 1: Backend Fixes
1. **Dynamic URL Support**: Update [app.ts](file:///Users/bhaveshvarma/Pictures/SSH_client/api/app.ts) to handle production vs development environment variables more robustly.
2. **Session Security**: Ensure `cookie.secure` is correctly handled for the `https` production environment.
3. **CORS Configuration**: Explicitly set the allowed origin to match `FRONTEND_URL` from the `.env` instead of using `true` (which can be problematic with `credentials: true` in some environments).

### Phase 2: Frontend Fixes
1. **API URL Handling**: Ensure [authStore.ts](file:///Users/bhaveshvarma/Pictures/SSH_client/src/store/authStore.ts) and [Login.tsx](file:///Users/bhaveshvarma/Pictures/SSH_client/src/pages/Login.tsx) are using the correct backend URL (relative or absolute) based on where the app is hosted.
2. **Error Visibility**: Enhance error reporting in [App.tsx](file:///Users/bhaveshvarma/Pictures/SSH_client/src/App.tsx) and [Login.tsx](file:///Users/bhaveshvarma/Pictures/SSH_client/src/pages/Login.tsx) to provide clearer feedback if the auth check or redirect fails.

## 3. Verification Steps
1. **Check Backend Health**: Test the `/api/health` endpoint.
2. **Logs Review**: Check server logs (using `nodemon` output) to see if Passport or Google Strategy is throwing specific errors like `redirect_uri_mismatch`.
3. **Manual Test**: Attempt login in a local development environment first to confirm the code logic is sound.

**Note**: I will start by updating the environment handling and CORS settings to be more robust for the production domain seen in your screenshot.
